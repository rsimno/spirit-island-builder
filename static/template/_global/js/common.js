const translation_matrix = {
  "en": null
  , "de": {
    "Energy/Turn": "Energie/Runde"
    , "Card Plays": "Karten ausspielen"
    , "Air": "Luft"
    , "Sun": "Sonne"
    , "Moon": "Mond"
    , "Water": "Wasser"
    , "Fire": "Feuer"
    , "Earth": "Erde"
    , "Plant": "Pflanze"
    , "Animal": "Tier"
    , "Any": "Beliebig"
    , "Sand": "Wüste"
    , "Sands": "Wüste"
    , "Mountain": "Berge"
    , "Wetland": "Sumpf"
    , "Jungle": "Dschungel"
    , "Ocean": "Ozean"
    , "Blight": "Ödnis"
    , "Invader": "Invasor"
    , "Invaders": "Invasoren"
    , "Explorer": "Entdecker"
    , "Town": "Dorf"
    , "City": "Stadt"
    , "Dahan": "Dahan"
    , "fear": "Furcht"
    , "Wilds": "Wildnis"
    , "Disease": "Seuche"
    , "Strife": "Streit"
    , "Beasts": "Bestien"
    , "Badlands": "Einöde"
    , "Presence": "Präsenz"
    , "presence": "Präsenz"
    , "Inland land": "Binnengebiet"
    , "Coastal land": "Küstengebiet"
    , "Your Presence": "Deine Präsenz"
    , "Your Incarna": "Dein Inkarna"
    , "speed": "wann"
    , "range": "wie weit"
    , "target land": "Wo"
    , "target": "Wen"
    , "Gather 1 % into 1 of your Lands": "Sammle 1 % in eins deiner Gebiete"
    , "% Energy": "% Energie"
    , "Empower Incarna": "Inkarna ermächtigen"
    , "Add 1 % to 1 of your Lands": "Füge 1 % in einem deiner Gebiete hinzu"
    , "Move a Presence to % land": "Bewege eine Präsenz in ein Gebiet %"
    , "Move a Presence %": "Bewege eine Präsenz %"
    , "+1 Card Play/Turn": "+1 Karte ausspielen"
    , "+% Energy": "+% Energie"
    , "% Card Play": "% Karte ausspielen"
    , "% Card Plays": "% Karten ausspielen"
    , " +% Card Play this turn": "Diese Runde % Karte ausspielen"
    , " +% Card Plays this turn": "Diese Runde % Karten ausspielen"
    , "Gain Power Card": "Fähigkeiten- karte erhalten"
    , "Reclaim Cards": "Alle Karten wiedererlangen"
    , "Reclaim One": "1 Karte wiedererlangen"
    , "Reclaim Half": "Die Hälfte wiedererlangen"
    , "round up": "aufgerundet"
    , "Forget Power Card": "Fähigkeitenkarte vergessen"
    , "Discard 2 Power Cards": "2 Fähigkeitenkarten abwerfen"
    , "Discard 1 Power Card": "Fähigkeitenkarte abwerfen"
    , "Gain 1 Time": "Erhalte 1 Zeit"
    , "Gain 2 Time": "Erhalte 2 Zeit"
    , "Gain ": ""
    , "Destroy 1 of your Presence": "Vernichte 1 deiner Präsenzen"
    , "Destroyed Presence": "Vernichtete Präsenzen"
    , "up to % Destroyed Presence": "Bis zu % vernichtete Präsenzen"
    , "One of your Powers may be Fast": "Eine deiner Fähigkeien darf schnell sein."
    , "Pay 2 Energy to Gain a Power Card": "Zahle 2 Energie um eine Fähigkeitenkarte zu erhalten"
    , "You may ignore Range this turn": "Du darfst Reichweite diese Runde ignorieren"
    , "Element": "Element"
    , "Prepare % Element Marker": "% Element-Plättchen vorbereiten"
    , "Prepare % Element Markers": "% Element-Plättchen vorbereiten"
    , "Discard % Element Marker": "% Element-Plättchen abgeben"
    , "Discard % Element Markers": "% Element-Plättchen abgeben"
    , "Isolate % of your Lands": "Isoliere % deiner Gebiete"
    , "Reclaim None": "Keine wiedererlangen"
    , "Move Presence %": "Bewege Präsenz %"
    , "Deal 1 Damage in one of your Lands": "Füge 1 Schaden in einem deiner Gebiete hinzu"
    , "Deal 2 Damage in one of your Lands": "Füge 2 Schaden in einem deiner Gebiete hinzu"
    , "Add a Presence": "Präsenz platzieren"
    , "Add a Presence%": "Präsenz% platzieren"
    , "Gain Energy": "Energie erhalten"
    , "You may Pay 2 Energy to Gain a Power Card": "Du kannst 2 Energie bezahlen, um eine Fähigkeitenkarte zu erhalten"
    , "Gain % Energy": "% Energie erhalten"
    , "Gather 1 Presence into %": "Versammle 1 Präsenz in %"
    , "Push 1 Presence from %": "Verschiebe 1 Präsenz aus %"
    , " to any ": " in einem "
    , " to ": " in "
    , " Land without ": " Gebiet ohne "
    , " and ": " und "
    , " and no ": " und nicht "
    , " or ": " oder "
    , " or no ": " oder nicht "
    , " or a %": " oder %"
    , "Your " : "Eigener"
    , "Land with ": "Gebiet mit "
    , " Land with ": " Gebiet mit "
    , " with ": " mit "
    , "Gain %": "%"
    , "Gain Power Card from Days That Never Were": ""
    , " to any Land": ""
    , "+% Range": "+% Reichweite"
    , "Push 1 Town/City from 1 of your Lands": "Verschiebe 1 Dorf/Stadt aus einem deiner Gebiete"
    , "Discard a Power Card with %": "Wirf eine Fähigkeitenkarte mit % ab"
    , "Move Incarna": "Bewege deinen Inkarna"
    // , "x2: Erhalte 1 Zeit": ""
    , "Move a Presence": "Präsenz bewegen"
    // , "x3: Erhalte 1 Zeit": ""
    , "Energy Per Play": "Energie pro Aktion" //###???
    , "Push 1 Dahan from 1 of your Lands": "Verschiebe 1 Dahan aus einem deiner Gebiete"
    , " and a %": " und ein %"
    , "Gather up to 1 Beasts into a Land": "Versammle biz zu 1 Bestie in einem Gebiet"
    , " and +% more per %": " und +% pro %"
    , " and +% more per % Showing": " und +% pro sichtbares %"
    , "Gain % Energy per %": "% Energie pro %"
    , "Gain % Energy per % Showing": "% Energie pro sichtbares %"
    , "Move up to % Presence together": "Bewege bis zu % Präsenzen zusammen"
    , "Add % together": "Füge % zusammen hinzu"
    , "Reclaim All Cards with %": "Alle Karten mit % wiedererlangen"
    , "Isolate 1 of Your Lands": "Isoliere 1 deiner Gebiete"
    , "Isolate a Land": "Isoliere ein Gebiet"
    , "Gain Major Power Card": "Starke Fähigkeitenkarte erhalten"
    , "Add a Presence to any Land": "Präsenz in beliebigem Gebiet platzieren"
    // , "+1 Play for Impending Only" 
    // , "2 Energy/Turn on Impending Cards"
    // , "+1 Play for Impending Only"
    , "cost": "Kosten"
    , "special rules": "Spezialregeln"
    , "Growth": "Wachstum"
    , "innate powers": "Permanente Fähigkeiten"
    


    ///// Blight Card /////
    , "Still Healthy Island": "Noch blühende Insel"
    , "for now": "bis jetzt"
    , "Blighted Island": "Verödete Insel"
    , "draw a new Blight Card.": "Weitere Verödete Insel Karte ziehen"
    , "It comes into play already flipped.": "Sie wird direkt umgedreht"
    , "players lose.": "Niederlage"

    // lore
    , "setup": "Spielvorbereitung"
    , "play style": "Spielstil"
    , "complexity": "Komplexität"
    , "summary of powers": "Zusammenfassung der Fähigkeiten"
    , "offense": "Angriff"
    , "control": "Bewegung"
    , "fear": "Furcht"
    , "defense": "Verteidigung"
    , "utility": "Sonstiges"
    , "uses": "verwendet"

    // adversary
    , "base difficulty": "Basisschwierigkeit"
    , "Additional Loss Condition": "Zusätzliche Niederlage-Bedingung"
    , "Escalation": "Eskalation Stufe II"
    , "Level": "Level"
    , "Difficulty": "Schwierigkeit"
    , "Fear Cards": "Furcht-Karten"
    , "Game Effects": "Effekte"
    , "cumulative": "kumulativ"

  }
}
function translate_text(text, args=[]) {
  if(!isNaN(text)) {
    return text;
  }
  let result_text = "";
  let lang = document.documentElement.lang;
  if(!translation_matrix[lang]) {
    result_text = text;
  }
  else {
    if (text in translation_matrix[lang]) {
      result_text = translation_matrix[lang][text];
    }
    else {
      result_text = text;
      console.log("###Translation missing: \""+text+"\"");
    }
  }

  args.forEach(arg => {
    result_text = result_text.replace(/%/, arg);
  });
  return result_text;
}

function replaceIcon(html) {
  var result = html;

  var regEx = new RegExp("(\\{[^\\}]*\\})", "ig");
  var matchs = result.match(regEx);
  const terrainSingle = new Set(["wetland", "wetlands", "mountain", "sand", "sands", "jungle"]);
  const terrainDouble = new Set([
    "ocean",
    "jungle-wetland",
    "wetland-jungle",
    "jungle-sand",
    "sand-jungle",
    "jungle-sands",
    "sands-jungle",
    "sand-wetland",
    "wetland-sand",
    "sands-wetland",
    "wetland-sands",
    "mountain-jungle",
    "jungle-mountain",
    "mountain-wetland",
    "wetland-mountain",
    "mountain-sand",
    "sand-mountain",
    "mountain-sands",
    "sands-mountain",
  ]);

  for (var match of matchs || []) {
    iconHtml = getIconHTML(match);
    result = result.replace(new RegExp(match, "ig"), iconHtml);
  }

  return result;

  // Function that processes matches into icon HTML
  function getIconHTML(match) {
    var iconName = match.replace("{", "").replace("}", "");
    let iconHtml;

    var iconNamePieces = iconName.split(",");
    let elementCount = "";
    let elementCountText = "";
    if (iconNamePieces[1]) {
      console.log("multi-pieces");
      iconName = iconNamePieces[0];
      elementCount = iconNamePieces[1];
      elementCountText += "<icon-count>" + elementCount + "</icon-count>";
    }

    iconHtml = elementCountText;

    // Catch "/" options to merge into single icon
    var iconSplit = iconName.split("/");
    if (iconSplit[1]) {
      console.log("comining a split icon...");
      let finalIcon = "";
      iconSplit.forEach((icon, i) => {
        finalIcon += getIconHTML("{" + icon + "}");
        if (i < iconSplit.length - 1) {
          finalIcon += "/";
        }
      });
      iconHtml = "<binder>" + elementCountText + finalIcon + "</binder>";
      console.log(iconHtml);
      return iconHtml;
    }

    let HTMLTag = "icon";

    // Check for 'no'
    let is_no = "";
    let no_icon = "";
    if (iconName.startsWith("no-")) {
      // is_no = "no ";
      no_icon = "<no-icon></no-icon>";
      iconName = iconName.substring(3);
    }

    // Check for terrain types
    let is_terrain = "";
    if (terrainSingle.has(iconName)) {
      is_terrain = " terrain-single";
    } else if (terrainDouble.has(iconName)) {
      is_terrain = " terrain-double";
    }

    // Check for Incarna
    if (iconName.startsWith("incarna-")) {
      iconName = "incarna " + iconName.substring(8);
    }

    // Check for Range
    let range_num = "";
    let num_val = "";
    if (iconName.startsWith("range-")) {
      HTMLTag = "range";
      range_num = iconName.substring(6);
      if (isNaN(range_num)) {
        range_num = '<icon class="range-small-icon ' + range_num + '"></icon>';
      } else {
        range_num = "<range-value>" + range_num + "</range-value>";
      }
      iconName = "range";
      num_val = range_num;
    } else if (iconName.startsWith("gain-range-")) {
      HTMLTag = "range";

      range_num = "+" + iconName.substring(11);
      iconName = "gain-range";
      num_val = range_num;
      /*       if(isNaN(range_num)){
        range_num = '<icon class="range-small-icon '+range_num+'"></icon>'
      } */
    }

    if (iconName.startsWith("energy-")) {
      energy_num = iconName.substring(7);
      if (isNaN(energy_num)) {
      } else {
        HTMLTag = "custom-energy"; //"<growth-energy><value>" + flatEnergy + "</value></growth-energy>"
        energy_num = "<value>" + energy_num + "</value>";
        iconName = "";
        num_val = energy_num;
        console.log("energy icon test");
      }
    } else if (iconName.startsWith("gain-energy-")) {
      energy_num = iconName.substring(12);
      if (isNaN(energy_num)) {
      } else {
        HTMLTag = "custom-energy"; //"<growth-energy><value>" + flatEnergy + "</value></growth-energy>"
        energy_num = "<value>" + energy_num + "</value>";
        iconName = "gain";
        num_val = energy_num;
        console.log("energy gain icon test");
      }
    }

    iconHtml +=
      `<` +
      HTMLTag +
      ` class="` +
      is_no +
      iconName +
      is_terrain +
      `">` +
      num_val +
      no_icon +
      `</` +
      HTMLTag +
      `>`;

    return iconHtml;
  }
}
